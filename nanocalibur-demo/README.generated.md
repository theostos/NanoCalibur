# NanoCalibur Generated Canvas Runtime Input

This folder is generated by `nanocalibur/build_web_scene.py`.

Included files:
- `game_spec.json`
- `game_ir.json`
- `game_logic.ts`
- `interpreter.ts`
- `runtime_core.ts`
- `canvas_host.ts`
- `headless_host.ts`
- `headless_http_server.ts`
- `session_runtime.ts`
- `session_manager.ts`
- `replay_store_sqlite.ts`
- `symbolic_renderer.ts`
- `bridge.ts`
- `index.ts`
- `node.ts`

## Usage in a TypeScript web project

1. Place this folder in your project under `src/nanocalibur_generated`.

2. In your app entry file, add:

```ts
import { attachNanoCalibur } from './nanocalibur_generated';

const canvas = document.getElementById('game');
if (!(canvas instanceof HTMLCanvasElement)) {
  throw new Error('Canvas element #game not found.');
}

const host = attachNanoCalibur(canvas);

void host.start();
```

Notes:
- `CanvasHost` handles a fixed-step update loop, keyboard/mouse input phases, and actor collisions.
- `HeadlessHost` runs the same core logic without a browser canvas and exposes symbolic frames for LLM/RL loops.
- `HeadlessHttpServer` exposes HTTP endpoints (`/tools`, `/tools/call`, `/frame`, `/state`, `/step`) for remote clients.
- `NanoCaliburMCPServer` provides a minimal MCP-style `tools/list` and `tools/call` handler on top of `HeadlessHost`.
- Browser apps should import from `index.ts`; Node-only HTTP helpers are isolated in `node.ts`.
- Basic physics, sprite animation, and image preloading are configurable through `CanvasHostOptions`.
- Runtime logic is driven by `game_spec.json` + `game_logic.ts`.

## Headless Session Server + Dummy Client

`nanocalibur-demo/package.json` includes helper scripts:

- `npm run headless:server`
  Compiles generated TypeScript to `.nanocalibur_headless/` and starts a session-aware HTTP server on `http://127.0.0.1:7070` by default.
- `npm run dummy:random`
  Starts a random dummy client that joins a role and sends `llm_dummy_*` tool commands. Requires `NC_INVITE_TOKEN`.
- `npm run human:play`
  Starts a human terminal client that joins a role, sends keyboard commands, and renders live session snapshots.

Typical flow (human + dummy in one shared session):

1. Start server:

```bash
npm run headless:server
```

2. Create a session with two roles (from another terminal):

```bash
curl -sS -X POST http://127.0.0.1:7070/sessions \
  -H 'content-type: application/json' \
  -d '{"session_id":"demo_sess","loop_mode":"hybrid","roles":[{"id":"human_1","required":true},{"id":"dummy_1","required":true}]}'
```

3. Start human client with returned human invite token:

```bash
NC_BASE_URL=http://127.0.0.1:7070 \
NC_INVITE_TOKEN=<human_invite_token> \
npm run human:play
```

4. Start dummy with returned dummy invite token:

```bash
NC_BASE_URL=http://127.0.0.1:7070 \
NC_INVITE_TOKEN=<dummy_invite_token> \
npm run dummy:random
```

5. Start session with returned admin token:

```bash
curl -sS -X POST http://127.0.0.1:7070/sessions/demo_sess/start \
  -H 'content-type: application/json' \
  -d '{"admin_token":"<admin_token>"}'
```

`human:play` controls:
- movement: `zqsd`, `wasd`, or arrow keys
- `e`: call `spawn_bonus`
- `n`: call `llm_dummy_next_turn`
